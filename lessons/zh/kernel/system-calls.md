---
index: 3
lang: "zh"
title: "系统调用"
meta_title: "系统调用 - 内核"
meta_description: "了解 Linux 系统调用（syscalls）以及它们如何与内核交互。理解用户模式和内核模式，并使用 `strace` 进行调试。开始你的 Linux 之旅！"
meta_keywords: "Linux 系统调用，syscalls, 内核模式，用户模式，strace 命令，Linux 教程，Linux 初学者，Linux 指南"
---

## Lesson Content

还记得上一课的布兰妮吗？假设我们想见她，一起喝点东西。我们如何从站在人群中到进入她的核心圈子？我们会使用系统调用。系统调用就像贵宾通行证，可以让你通过一个秘密的侧门直接见到布兰妮。

系统调用（syscalls）为用户空间进程提供了一种请求内核为我们做事情的方式。内核通过系统调用 API 提供某些服务。这些服务允许我们读写文件、修改内存使用、修改网络等。服务的数量是固定的，所以你不能随意添加系统调用。你的系统已经有一个关于存在哪些系统调用的表，并且每个系统调用都有一个唯一的 ID。

我不会深入探讨系统调用的细节，因为那需要你懂一点 C 语言，但基本原理是，当你调用一个程序，比如 `ls` 时，这个程序内部的代码包含一个系统调用包装器（所以还不是实际的系统调用）。在这个包装器内部，它会调用系统调用，这将执行一个陷阱。然后这个陷阱被系统调用处理程序捕获，然后引用系统调用表中的系统调用。假设我们正在尝试调用 `stat()` 系统调用；它由一个 syscall ID 标识，`stat()` 系统调用的目的是查询文件的状态。现在请记住，你是在非特权模式下运行 `ls` 程序的。所以现在它看到你正在尝试进行系统调用，它就会将你切换到内核模式。在那里它会做很多事情，但最重要的是，它会查找你的 syscall 号码，根据 syscall ID 在表中找到它，然后执行你想要运行的函数。一旦完成，它将返回到用户模式，如果成功或发生错误，你的进程将收到一个返回状态。系统调用的内部工作原理非常详细；如果你想了解更多，我建议你在网上查找信息。

你实际上可以使用 `strace` 命令查看进程进行的系统调用。`strace` 命令对于调试程序执行方式很有用。

```bash
strace ls
```

## Exercise

熟能生巧！虽然系统调用的内部工作原理很复杂，但理解用户空间程序如何与内核交互是基础。掌握这种交互的最佳方法是练习执行这些底层操作的命令。以下是一些动手实验，以加强你对文件系统交互的理解，这些交互严重依赖于系统调用：

1. **[在 Linux 中导航文件系统](https://labex.io/zh/labs/comptia-navigate-the-filesystem-in-linux-590971)** - 练习 `ls`、`cd` 和 `pwd` 等基本命令，以在 Linux 文件系统中移动和检查，直接与内核的文件系统服务交互。
2. **[在 Linux 中管理文件和目录](https://labex.io/zh/labs/comptia-manage-files-and-directories-in-linux-590835)** - 学习使用 `mkdir`、`rm`、`cp` 和 `mv` 等命令创建、删除、复制和移动文件和目录，所有这些都涉及系统调用来执行其操作。
3. **[在 Linux 中查找文件和命令](https://labex.io/zh/labs/comptia-find-files-and-commands-in-linux-590834)** - 掌握使用 `find`、`whereis` 和 `which` 定位文件和命令的技术，进一步说明用户命令如何利用内核服务与文件系统交互。

这些实验将帮助你在实际场景中应用文件系统交互的概念，并建立对隐式依赖系统调用的基本 Linux 操作的信心。

## Quiz Question

什么用于从用户模式切换到内核模式？

## Quiz Answer

System call
