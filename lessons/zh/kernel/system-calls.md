---
lang: "zh"
title: "系统调用"
description: "了解 Linux 系统调用 (syscalls) 及其与内核的交互。理解用户模式和内核模式，并使用 `strace` 进行调试。开始您的 Linux 之旅！"
keywords: "Linux 系统调用，syscalls, 内核模式，用户模式，strace 命令，Linux 教程，Linux 入门，Linux 指南"
---

## Lesson Content

还记得上一课中的布兰妮吗？假设我们想见到她并一起喝点东西。我们如何从站在人群中，进入她最核心的圈子呢？我们会使用系统调用。系统调用就像是贵宾通行证，能让你通过一个秘密的侧门，直接通向布兰妮。

系统调用（syscalls）为用户空间进程提供了一种请求内核为我们做某事的方式。内核通过系统调用 API 提供某些服务。这些服务允许我们读写文件、修改内存使用、修改网络等。服务的数量是固定的，所以你不能随意添加系统调用。你的系统已经有一个现有的系统调用表，每个系统调用都有一个唯一的 ID。

我不会深入系统调用的具体细节，因为那需要你懂一些 C 语言，但基本原理是，当你调用像 `ls` 这样的程序时，程序内部的代码包含一个系统调用封装器（此时还不是真正的系统调用）。在这个封装器内部，它会调用系统调用，这将触发一个陷阱。这个陷阱随后被系统调用处理程序捕获，然后引用系统调用表中的系统调用。假设我们正在尝试调用 `stat()` 系统调用；它通过一个 syscall ID 标识，`stat()` 系统调用的目的是查询文件的状态。现在请记住，你是在非特权模式下运行 `ls` 程序的。所以现在它看到你正在尝试进行系统调用，它就会将你切换到内核模式。在那里它会做很多事情，但最重要的是，它会查找你的系统调用号，根据 syscall ID 在表中找到它，然后执行你想要运行的函数。一旦完成，它将返回到用户模式，如果成功或发生错误，你的进程将收到一个返回状态。系统调用的内部工作原理非常详细；如果你想了解更多，我建议你在网上查找信息。

你实际上可以使用 `strace` 命令查看进程进行的系统调用。
`strace` 命令对于调试程序执行方式非常有用。

```bash
strace ls
```

## Exercise

No exercises for this lesson.

## Quiz Question

What is used to switch from user mode to kernel mode?

## Quiz Answer

System call
